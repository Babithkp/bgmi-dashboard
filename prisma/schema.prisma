generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model Player {
  id       String  @id @default(auto()) @map("_id") @db.ObjectId
  name     String
  gameName String
  image    String
  team     Team?   @relation(fields: [teamId], references: [id], onDelete: Cascade)
  teamId   String? @db.ObjectId
}

model Team {
  id                  String                @id @default(auto()) @map("_id") @db.ObjectId
  name                String                @unique
  image               String
  players             Player[]
  createdAt           DateTime              @default(now())
  groupTeamTournament GroupTeamTournament[]
}

model Tournament {
  id                  String                @id @default(auto()) @map("_id") @db.ObjectId
  name                String
  image               String
  date                DateTime
  time                String
  matches             Match[]
  groups              Group[]
  groupTeamTournament GroupTeamTournament[]
}

model Group {
  id                  String                @id @default(auto()) @map("_id") @db.ObjectId
  name                String
  tournament          Tournament?           @relation(fields: [tournamentId], references: [id])
  tournamentId        String?               @db.ObjectId
  groupTeamTournament GroupTeamTournament[]
  matches             Match[]
}

model GroupTeamTournament {
  id           String     @id @default(auto()) @map("_id") @db.ObjectId
  group        Group      @relation(fields: [groupId], references: [id], onDelete: Cascade)
  groupId      String     @db.ObjectId
  tournament   Tournament @relation(fields: [tournamentId], references: [id], onDelete: Cascade)
  tournamentId String     @db.ObjectId
  team         Team       @relation(fields: [teamId], references: [id], onDelete: Cascade)
  teamId       String     @db.ObjectId

  @@unique([groupId, tournamentId, teamId])
}

model Match {
  id           String      @id @default(auto()) @map("_id") @db.ObjectId
  name         String
  status       String?     @default("Live")
  group        Group       @relation(fields: [groupId], references: [id], onDelete: Cascade)
  groupId      String      @db.ObjectId
  matchTeam    MatchTeam[]
  tournament   Tournament? @relation(fields: [tournamentId], references: [id], onDelete: Cascade)
  tournamentId String?     @db.ObjectId
  winTeam      MatchTeam?  @relation("MatchWinner", fields: [winnerId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  winnerId     String?     @db.ObjectId
  updatedAt    DateTime    @updatedAt

  @@unique([tournamentId, groupId, name])
}

model MatchTeam {
  id                 String                   @id @default(auto()) @map("_id") @db.ObjectId
  group              String                   @db.ObjectId
  name               String
  image              String
  status             String?                  @default("Live")
  match              Match?                   @relation(fields: [matchId], references: [id], onDelete: Cascade)
  matchId            String?                  @db.ObjectId
  playerPerformances MatchPlayerPerformance[]
  wonMatches         Match[]                  @relation("MatchWinner")

  @@unique([matchId, name])
}

model MatchPlayerPerformance {
  id               String     @id @default(auto()) @map("_id") @db.ObjectId
  name             String
  image            String
  placementPoints  Int        @default(0)
  finishesPoints   Int        @default(0)
  totalPoints      Int        @default(0)
  status           String     @default("Alive")
  teamContribution Int        @default(0)
  matchTeam        MatchTeam? @relation(fields: [matchTeamId], references: [id], onDelete: Cascade)
  matchTeamId      String?    @db.ObjectId
}
